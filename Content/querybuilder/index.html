<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸ§± Constructor de Consultas SQL</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); }
    .card { border-radius: 16px; transition: transform 0.3s; }
    .card:hover { transform: translateY(-4px); }
    .btn { border-radius: 12px; font-weight: 600; }
    .query-output { font-family: 'Fira Code', monospace; background: #1e1e1e; color: #d4d4d4; }
    .table-box { background: #e9ecef; padding: 10px; border-radius: 8px; cursor: grab; }
    .field-item { padding: 4px 8px; background: #f8f9fa; border-radius: 4px; margin: 2px 0; cursor: pointer; }
    .field-item:hover { background: #dee2e6; }
    .drop-zone { min-height: 100px; border: 2px dashed #ced4da; border-radius: 8px; padding: 10px; }
    .drop-zone.active { border-color: #0d6efd; background: rgba(13, 110, 253, 0.1); }
  </style>
</head>
<body class="bg-light">
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-12">
        <div class="card shadow-lg">
          <div class="card-header bg-primary text-white text-center">
            <h3><i class="fas fa-database me-2"></i>Constructor de Consultas SQL</h3>
            <p class="mb-0">Arrastra tablas y campos para construir consultas</p>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- Panel de tablas -->
              <div class="col-md-3">
                <h5>Tablas disponibles</h5>
                <div class="table-box mb-3" draggable="true" data-table="Usuarios">
                  <strong>Usuarios</strong>
                  <div class="field-item" data-field="ID">ID</div>
                  <div class="field-item" data-field="Nombre">Nombre</div>
                  <div class="field-item" data-field="Email">Email</div>
                </div>
                <div class="table-box mb-3" draggable="true" data-table="Pedidos">
                  <strong>Pedidos</strong>
                  <div class="field-item" data-field="ID">ID</div>
                  <div class="field-item" data-field="UsuarioID">UsuarioID</div>
                  <div class="field-item" data-field="Fecha">Fecha</div>
                </div>
              </div>
              <!-- Zona de construcciÃ³n -->
              <div class="col-md-6">
                <h5>Construye tu consulta</h5>
                <div id="dropZone" class="drop-zone mb-3">
                  <div class="text-muted fst-italic">Arrastra campos aquÃ­...</div>
                </div>
                <div class="d-grid gap-2">
                  <button id="buildQueryBtn" class="btn btn-primary">
                    <i class="fas fa-bolt me-2"></i>Generar Consulta
                  </button>
                </div>
              </div>
              <!-- Consulta generada -->
              <div class="col-md-3">
                <h5>Consulta generada</h5>
                <pre id="queryOutput" class="query-output p-3 rounded"></pre>
                <button id="copyQueryBtn" class="btn btn-success w-100">
                  <i class="fas fa-copy me-2"></i>Copiar
                </button>
              </div>
            </div>
            <div id="message" class="alert mt-4 d-none" role="alert">
              <i class="fas fa-info-circle me-2"></i>
              <span id="messageText"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const dropZone = document.getElementById('dropZone');
    const queryOutput = document.getElementById('queryOutput');
    const buildQueryBtn = document.getElementById('buildQueryBtn');
    const copyQueryBtn = document.getElementById('copyQueryBtn');
    const messageEl = document.getElementById('message');
    const messageText = document.getElementById('messageText');

    let draggedElement = null;

    // Drag and drop
    document.querySelectorAll('.table-box, .field-item').forEach(el => {
      el.addEventListener('dragstart', e => {
        draggedElement = e.target;
        e.dataTransfer.setData('text/plain', e.target.dataset.field || e.target.dataset.table);
      });
    });

    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.classList.add('active');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('active');
    });

    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('active');
      if (draggedElement) {
        const field = draggedElement.dataset.field;
        const table = draggedElement.dataset.table;
        if (field) {
          const fieldEl = document.createElement('div');
          fieldEl.className = 'field-item';
          fieldEl.textContent = `${table}.${field}`;
          fieldEl.dataset.fullField = `${table}.${field}`;
          dropZone.appendChild(fieldEl);
        }
      }
    });

    // Generar consulta SQL
    buildQueryBtn.addEventListener('click', () => {
      const fields = Array.from(dropZone.querySelectorAll('.field-item'));
      if (fields.length === 0) {
        showMessage('Agrega campos a la zona de construcciÃ³n âŒ', 'danger');
        return;
      }

      const fieldNames = fields.map(f => f.dataset.fullField).join(', ');
      const query = `SELECT ${fieldNames} FROM Usuarios`;
      queryOutput.textContent = query;
      showMessage('Consulta generada âœ…', 'success');
    });

    // Copiar consulta
    copyQueryBtn.addEventListener('click', () => {
      if (queryOutput.textContent) {
        navigator.clipboard.writeText(queryOutput.textContent).then(() => {
          showMessage('Consulta copiada âœ…', 'success');
        });
      }
    });

    function showMessage(text, type = 'info') {
      messageText.textContent = text;
      messageEl.className = `alert alert-${type} d-block`;
      setTimeout(() => messageEl.classList.add('d-none'), 3000);
    }
  </script>
</body>
</html>